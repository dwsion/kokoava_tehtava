<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Säätiedot kaupungille</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            text-align: center;
            margin-bottom: 20px;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            width: 150px;
            margin-right: 10px;
        }
        input[type="submit"] {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .weatherContainer {
            margin-top: 20px;
            text-align: center;
            
        }
        .weatherItem {
            display: flex; /* Käytetään flexboxia laatikoissa */
            border: 1px solid #ddd;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .imageContainer {
            margin-right: 20px;
        }
        .imageContainer img {
            max-width: 300px; /* Säädetään kuvan maksimileveys */
            border-radius: 5px; /* Kulmat pyöristetään */
        }
        .weatherInfo {
            flex: 1; /* Täyttää jäljelle jäävän tilan */
            text-align: left; /* Vasemmalle perustuva teksti */
        }
    </style>
</head>
<body>
    <h1>Hae säätiedot kaupungille</h1>
    <form id="weatherForm">
        <input type="text" id="cityInput" placeholder="Kaupunki" required>
        <input type="submit" value="Hae säätiedot">
    </form>

    <div id="weatherContainer" class="weatherContainer"></div>

    <script>
        const apiKey = '314de1b8dabfbace7321a5ff474e27d1'; // Aseta oma OpenWeatherMap API-avain tähän
        const unsplashAccessKey = 'kOtx4NsMYxC68f_HJIWSYP4cBTQoZeMzy2-aDFBLO2g'; // Aseta oma Unsplash API-avain tähän

        document.getElementById('weatherForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const city = document.getElementById('cityInput').value.trim();
            fetchWeather(city);
        });

        function fetchWeather(city) {
            const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${apiKey}&lang=fi`;

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Tietoja ei löytynyt.');
                    }
                    return response.json();
                })
                .then(data => {
                    const countryName = getCountryName(data.sys.country);
                    displayWeather(data, countryName);
                    fetchImage(data.name); // Hae kuva kaupungin mukaan
                })
                .catch(error => {
                    document.getElementById("weatherContainer").innerHTML = 
                    "<p>Tietoa ei pystytä hakemaan. Tarkista kaupunki ja yritä uudelleen.</p>";
                });
        }

        function getCountryName(countryCode) {
            const countryNames = {
                "FI": "Suomi",
                "SE": "Ruotsi",
                "NO": "Norja",
                "DE": "Saksa",
                "FR": "Ranska",
                "US": "Yhdysvallat",
                "GB": "Iso-Britannia",
                "JP": "Japani",
                "CN": "Kiina",
                // Lisää muita maita tarpeen mukaan
            };
            return countryNames[countryCode] || countryCode; // Palauttaa koodin jos ei löydy nimeä
        }

        function displayWeather(data, countryName) {
            let teksti = `<div class='weatherItem'>
                            <div class='imageContainer'>
                                <img src='http://openweathermap.org/img/w/${data.weather[0].icon}.png' alt='sääkuva'>
                            </div>
                            <div class='weatherInfo'>
                                <h5>Maa: ${countryName}</h5>
                                <p>Kaupunki: ${data.name}</p>
                                <p>Kuvaus: ${data.weather[0].description}</p>
                                <p>Lämpötila: ${data.main.temp} &deg;C</p>
                                <p>Tuulen nopeus: ${data.wind.speed} m/s</p>
                            </div>
                          </div>`;
            document.getElementById("weatherContainer").innerHTML = teksti; // Tyhjennetään aiemmat tulokset
        }

        function fetchImage(cityName) {
            // Haetaan kuva Unsplashista
            const url = `https://api.unsplash.com/search/photos?query=${cityName}&client_id=${unsplashAccessKey}`;

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Kuvaa ei löytynyt.');
                    }
                    return response.json();
                })
                .then(data => {
                    const imageUrl = data.results.length > 0 ? data.results[0].urls.regular : 'https://via.placeholder.com/300x200?text=Kuva+ei+loydy';
                    document.querySelector('.imageContainer img').src = imageUrl; // Päivitetään kuva
                })
                .catch(error => {
                    console.error(error);
                });
        }
    </script>
</body>
</html>
